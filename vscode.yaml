package:
  name: vscode
  version: 1.80.1
  epoch: 0
  description: "Visual Studio Code"
  copyright:
    - license: MIT

environment:
  contents:
    packages:
      - busybox
      - build-base
      - git
      - nodejs-16
      - yarn
      - python3
      - pkgconf
      - libsecret-dev
      - glib-dev
      - libgcrypt-dev
      - libxkbfile-dev
      - libx11-dev
      - xorgproto
      - libgc++

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/microsoft/vscode
      tag: ${{package.version}}
      expected-commit: 74f6148eb9ea00507ec113ec51c489d6ffb4b771
      destination: vscode

  - working-directory: /home/build/vscode
    runs: |
      yarn

      node build/lib/preLaunch.js
      mkdir -p "${{targets.destdir}}"/usr/bin
      install -dm755 .build/electron ${{targets.destdir}}/usr/bin/

update:
  enabled: true
  github:
    identifier: microsoft/vscode
    use-tag: true
