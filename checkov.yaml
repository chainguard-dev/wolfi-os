package:
  name: checkov
  version: 3.0.24
  epoch: 1
  description: "static code and composition analysis tool for IaC"
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - python3

environment:
  contents:
    packages:
      - build-base
      - ca-certificates-bundle
      - glibc
      - linux-headers
      - posix-libc-utils
      - py3.10-pip
      - python-3.10-dev
      - wolfi-base
      - wolfi-baselayout

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/bridgecrewio/checkov
      tag: ${{package.version}}
      expected-commit: 62a42ca849e9e832d63bb0d912a89b500c98a4af
      destination: checkov

  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/share/app/checkov && mkdir -p "${{targets.destdir}}"/usr/bin
      mv checkov/* "${{targets.destdir}}"/usr/share/app/checkov
      cd "${{targets.destdir}}"/usr/share/app/checkov

      python3.10 -m venv .venv
      .venv/bin/pip3.10 install .

      CHECKOV_PYTHON_PATH="#!/usr/share/app/checkov/.venv/bin/python3.10"
      sed -i "1s,.*,$CHECKOV_PYTHON_PATH," checkov/main.py

      ln -s /usr/share/app/checkov/checkov/main.py "${{targets.destdir}}"/usr/bin/checkov

  - uses: strip

update:
  enabled: false
