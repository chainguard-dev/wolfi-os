package:
  name: libjxl
  version: 0.10.3
  epoch: 0
  description: JPEG XL image format reference implementation
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - asciidoc
      - brotli-dev
      - build-base
      - busybox
      - ca-certificates-bundle
      - clang
      - cmake
      - docbook-xml
      - gdk-pixbuf-dev
      - gflags-dev
      - giflib-dev
      - gtest-dev
      - highway-dev
      - lcms2-dev
      - libjpeg-turbo-dev
      - libpng-dev
      - libxml2
      - libxml2-dev
      - libxslt-dev
      - llvm-lld-17
      - llvm17-dev
      - openexr-dev
      - samurai
      - zlib-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/libjxl/libjxl
      tag: v${{package.version}}
      expected-commit: 4a3b22d2600f92d8706fb72d85d52bfee2acbd54
      recurse-submodules: true

  - uses: cmake/configure
    with:
      opts: |
        -DCMAKE_BUILD_TYPE=Release \
        -DBUILD_TESTING=OFF \
        -DJPEGXL_FORCE_SYSTEM_BROTLI=ON \

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: libjxl-doc
    pipeline:
      - uses: split/manpages
    description: libjxl manpages

  - name: libjxl-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libjxl
    description: libjxl dev
