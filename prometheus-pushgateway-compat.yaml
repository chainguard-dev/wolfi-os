#nolint:valid-pipeline-git-checkout-commit,valid-pipeline-git-checkout-tag
package:
  name: prometheus-pushgateway-compat
  version: 1.6.2
  epoch: 0
  description: "Pushgateway Bitnami compatible"
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - bash

pipeline:
  - uses: git-checkout
    with:
      branch: main
      repository: https://github.com/bitnami/containers

  - runs: |
      mkdir -p "${{targets.destdir}}"/opt/bitnami
      mkdir -p "${{targets.destdir}}"/opt/bitnami/licenses
      mkdir -p "${{targets.destdir}}"/opt/bitnami/pushgateway/bin

      cd bitnami/pushgateway/1/debian-11

      cp -R ./prebuildfs/opt/bitnami/* ${{targets.destdir}}/opt/bitnami/
      chmod g+rwX "${{targets.destdir}}"/opt/bitnami

  - runs: |
      ln -sf /usr/bin/pushgateway "${{targets.destdir}}"/opt/bitnami/pushgateway/bin/pushgateway

  - uses: strip

update:
  enabled: false
  manual: true # This requires manual updates because of the upstream repo does not release tags and branches.
  github:
    identifier: bitnami/containers
