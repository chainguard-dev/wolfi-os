package:
  name: e2fsprogs
  version: 1.46.5
  epoch: 0
  description: "Standard Ext2/3/4 filesystem utilities"
  target-architecture:
    - all
  copyright:
    - paths:
      - "*"
      attestation: TODO
      license: GPL-2.0-or-later AND LGPL-2.0-or-later AND BSD-3-Clause AND MIT

environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - util-linux-dev
      - gawk
      - linux-headers

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/tytso/e2fsprogs/archive/v${{package.version}}.tar.gz
      expected-sha512: 9e21e27b8be86b891cfc5f8c963c398e27f476d5663d6313ae48dc5d3c95f4f4ac95a9f37e971ac1dd0b8beb05b1f83b510027731e3aa906135ea21e99bea9b8
  - runs: |
      ./configure \
          --build=$CBUILD \
          --host=$CHOST \
          --mandir=/usr/share/man \
          --enable-elf-shlibs \
          --enable-lto \
          --enable-symlink-install \
          --disable-fsck \
          --disable-uuidd \
          --disable-libuuid \
          --disable-libblkid \
          --disable-nls
  - uses: autoconf/make
  - runs: |
      mkdir -p ${{targets.destdir}}/etc
      make -j1 MKDIR_P="install -d" DESTDIR="${{targets.destdir}}" install install-libs
  - uses: strip

subpackages:
  - name: "e2fsprogs-dev"
    description: "headers for e2fsprogs"
    pipeline:
      - uses: split/dev
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mkdir -p ${{targets.subpkgdir}}/usr/share

          mv ${{targets.destdir}}/usr/bin/compile_et ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/mk_cmds ${{targets.subpkgdir}}/usr/bin\

          mv ${{targets.destdir}}/usr/share/et ${{targets.subpkgdir}}/usr/share
          mv ${{targets.destdir}}/usr/share/ss ${{targets.subpkgdir}}/usr/share

  - name: "libcom_err"
    description: "Common error description library"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/lib
          mv ${{targets.destdir}}/lib/libcom_err* ${{targets.subpkgdir}}/lib