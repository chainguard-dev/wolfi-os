package:
  name: font-ubuntu
  version: 0.869_git20240321
  epoch: 0
  description: Ubuntu font family
  copyright:
    - license: Ubuntu-font-1.0

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle

# transform melange version 1.81.0 => 1_81_0
var-transforms:
  - from: ${{package.version}}
    match: _
    replace: +
    to: mangled-package-version

pipeline:
  - uses: git-checkout
    with:
      expected-commit: 00eff5ab690db23c5b6ed74d02b7c46e473e35e2
      repository: https://git.launchpad.net/ubuntu/+source/fonts-ubuntu
      tag: applied/${{vars.mangled-package-version}}-0ubuntu1

  - runs: |
      mkdir -p ${{targets.destdir}}/usr/share/fonts/${{package.name}} \
        ${{targets.destdir}}/etc/fonts/conf.avail \
        ${{targets.destdir}}/etc/fonts/conf.d

      install -Dm644 ./*.ttf -t ${{targets.destdir}}/usr/share/fonts/ubuntu
      install -Dm644 81-ubuntu.conf -t ${{targets.destdir}}/usr/share/fontconfig/conf.avail/
      install -Dm644 LICENCE.txt ${{targets.destdir}}/usr/share/licenses/${{package.name}}/LICENCE

  - uses: strip

update:
  enabled: true
  version-transform:
    - match: ^(.+)\+git(\d+)"ubuntu"(\d+)
      replace: $1_git$2
  git:
    strip-prefix: applied/
