name: Build a release binary using cargo build

needs:
  packages:
    - rust
    - busybox
    - ca-certificates-bundle

inputs:
  target:
    description: |
      The name of the binary to build

  subpackage:
    description: |
      Indicates that the build will write to a subpackage target folder
    default: "false"

pipeline:
  - runs: |
      cargo build --release -vv

      if [ "${{inputs.subpackage}}" == "true" ]; then
        DEST_DIR="${{targets.subpkgdir}}"/usr/bin/
      else
        DEST_DIR="${{targets.destdir}}"/usr/bin/
      fi

      mkdir -p ${DEST_DIR}
      mv target/release/${{inputs.target}} ${DEST_DIR}
