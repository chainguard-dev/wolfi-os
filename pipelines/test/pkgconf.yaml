name: pkgconf
needs:
  packages:
    - pkgconf

inputs:
  flags:
    description: "whitespace separated list of flags to pass to pkgconf; e.g. --libs --modversion --cflags --exists"
    default: "--libs"
    required: false

pipeline:
  - name: pkgconf build dependency check
    runs: |
      # Get our dev package name, which is possibly a sub package
      dev_pkg=$(basename ${{targets.contextdir}})
      # Find all pc files installed by this dev_pkg
      for pc_file in $(apk info -L "$dev_pkg" | grep "\.pc$"); do
        # Try to get the library name from the pc filename
        lib_name=$(basename "$pc_file" ".pc")
        # Run some package config tests, which will likely be used by
        # other packages that have build dependencies on this dev package
        for i in ${{inputs.flags}}; do
          pkgconf $i $lib_name
        done
      done
