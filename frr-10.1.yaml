package:
  name: frr-10.1
  version: 10.1.1
  epoch: 0
  description: The FRRouting Protocol Suite
  copyright:
    - license: GPL-2.0-only
  dependencies:
    runtime:
      - python-3.11

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bison
      - build-base
      - busybox
      - elfutils-dev
      - flex
      - json-c-dev
      - libcap-dev
      - libtool
      - libyang-dev
      - linenoise-dev
      - lua5.3
      - lua5.3-dev
      - m4
      - openssf-compiler-options
      - openssl-dev
      - patch
      - pcre2-dev
      - protobuf-c-dev
      - python3-dev
      - readline-dev
      - rtrlib-dev
      - zeromq-dev

pipeline:
  - uses: git-checkout
    with:
      expected-commit: dbf8dac1cea2b1235746e2d966a8ded9cffd5dc3
      repository: https://github.com/FRRouting/frr
      tag: frr-${{package.version}}

  - runs: autoreconf -vif

  - uses: autoconf/configure
    with:
      opts: |
        --sbindir=/usr/lib/frr \
        --localstatedir=/var/run/frr \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --enable-rpki \
        --enable-vtysh \
        --enable-multipath=64 \
        --enable-vty-group=frrvty \
        --enable-user=frr \
        --enable-group=frr \
        --enable-pcre2posix \
        --enable-scripting \
        --with-crypto=openssl

  - uses: autoconf/make

  - uses: autoconf/make-install

  - runs: |
      cp docker/alpine/docker-start ${{targets.destdir}}/usr/lib/frr/docker-start
      install -d ${{targets.destdir}}/etc/frr
      install -m 0644 tools/etc/frr/daemons ${{targets.destdir}}/etc/frr/daemons
      install -d ${{targets.destdir}}/etc/init.d
      ln -s /usr/lib/frr ${{targets.destdir}}/etc/init.d/frr

  - uses: strip

subpackages:
  - name: frr-dev
    description: dev library for frr
    dependencies:
      runtime:
        - frr
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf

  - name: frr-debug
    pipeline:
      - uses: split/debug
    description: frr debug

update:
  enabled: true
  github:
    identifier: frrouting/frr
    strip-prefix: frr-
    tag-filter: frr-10.1.

test:
  pipeline:
    - name: "version and help tests"
      runs: |
        /usr/lib/frr/zebra --version
        /usr/lib/frr/bgpd --version
        /usr/lib/frr/bfdd --version
