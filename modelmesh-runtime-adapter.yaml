package:
  name: modelmesh-runtime-adapter
  version: 0.12.0
  epoch: 0
  description: Unified runtime-adapter package of the sidecar containers which run in the modelmesh pods

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/kserve/modelmesh-runtime-adapter.git
      expected-commit: 5d0c9a008cce30b2b3839874c9f1f2ca8ddc38de
      tag: v${{package.version}}

data:
  - name: controller-components
    items:
      model-mesh-mlserver-adapter: 
        bump: true
        description: "Adapter which implements the internal model-mesh model management API for MLServer Inference Server."
        output: mlserver-adapter
        test: "MLServer runtime adapter started"
      model-mesh-ovms-adapter:
        bump: true
        description: "Adapter which implements the internal model-mesh model management API for OpenVINO Model Server."
        output: ovms-adapter
        test: "OVMS Runtime started"
      model-mesh-torchserve-adapter:
        bump: true
        description: "Adapter which implements the internal model-mesh model management API for TorchServe."
        output: torchserve-adapter
        test: "TorchServe runtime adapter started"
      model-mesh-triton:
        bump: true
        description: "Adapter which implements the internal model-mesh model management API for Triton Inference Server."
        output: triton-adapter
        test: "Triton runtime adapter started"
      model-serving-puller:
        bump: false
        description:  "A component of ModelMesh Serving which provides a common way to pull models from storage and hand them off to model runtime frameworks"
        output: puller
        test: "starting clean up of cached clients"

subpackages:
  - range: controller-components
    name: "${{range.key}}"
    description: "${{range.value.description}}"
    pipeline:
      - uses: go/build
        with:
          output: ${{range.value.output}}
          packages: ./${{range.key}}
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            ${{range.key}} | grep ${{range.value.test}}
