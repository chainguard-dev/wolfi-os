package:
  name: modelmesh-runtime-adapter
  version: 0.12.0
  epoch: 0
  description: Unified runtime-adapter package of the sidecar containers which run in the modelmesh pods
  dependencies:
    runtime:
      - python-3
      - py3-absl-py
      - py3-astunparse
      - py3-cachetools
      - py3-certifi
      - py3-charset-normalizer
      - py3-flatbuffers
      - py3-gast
      - py3-google-auth
      - py3-google-auth-oauthlib
      - py3-google-pasta
      - py3-grpcio
      - py3-h5py
      - py3-idna
      - py3-importlib-metadata
      - py3-keras
      - py3-libclang
      - py3-markdown
      - py3-markupsafe
      - py3-numpy
      - py3-oauthlib
      - py3-opt-einsum
      - py3-packaging
      - py3-pip
      - py3-protobuf                    
      - py3-asn1                     
      - py3-asn1-modules             
      - py3-requests                    
      - py3-requests-oauthlib          
      - py3-rsa                      
      - py3-setuptools                  
      - py3-six  
      - py3-tensorflow-core
      # TODO: add more tensor stuff
      # tensorboard                  2.13.0
      # tensorboard-data-server      0.7.2
      # tensorflow                   2.13.1
      # tensorflow-estimator         2.13.0
      # tensorflow-io-gcs-filesystem 0.34.0
      - py3-termcolor                    
      - py3-typing-extensions            
      - py3-urllib3                      
      - py3-werkzeug                     
      - py3-wheel                        
      - py3-wrapt                        
      - py3-zipp                         

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/kserve/modelmesh-runtime-adapter.git
      expected-commit: 5d0c9a008cce30b2b3839874c9f1f2ca8ddc38de
      tag: v${{package.version}}
  - uses: go/build
    with:
      output: /opt/app/mlserver-adapter
      packages: ./model-mesh-mlserver-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: /opt/app/ovms-adapter
      packages: ./model-mesh-ovms-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: /opt/app/torchserve-adapter
      packages: ./model-mesh-torchserve-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: /opt/app/triton-adapter
      packages: ./model-mesh-triton-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: /opt/app/puller
      packages: ./model-serving-puller
      ldflags: -s -w
  - uses: strip

test:
  pipeline:
    - name: TEST
      runs: |
        exit 1
