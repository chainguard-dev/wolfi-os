package:
  name: modelmesh-runtime-adapter
  version: 0.12.0
  epoch: 0
  description: Unified runtime-adapter package of the sidecar containers which run in the modelmesh pods

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/kserve/modelmesh-runtime-adapter.git
      expected-commit: 5d0c9a008cce30b2b3839874c9f1f2ca8ddc38de
      tag: v${{package.version}}
  - name: Make destination directory
    runs: |
      mkdir -p ${{targets.destdir}}/opt/app
      mkdir -p ${{targets.destdir}}/opt/scripts

  - uses: go/build
    with:
      output: ${{targets.destdir}}/opt/app/mlserver-adapter
      packages: ./model-mesh-mlserver-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: ${{targets.destdir}}/opt/app/ovms-adapter
      packages: ./model-mesh-ovms-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: ${{targets.destdir}}/opt/app/torchserve-adapter
      packages: ./model-mesh-torchserve-adapter
      ldflags: -s -w
  - uses: strip

  - uses: go/build
    with:
      output: ${{targets.destdir}}/opt/app/triton-adapter
      packages: ./model-mesh-triton-adapter
      ldflags: -s -w
  - uses: strip
  
  - uses: go/build
    with:
      output: ${{targets.destdir}}/opt/app/puller
      packages: ./model-serving-puller
      ldflags: -s -w
  - uses: strip
