package:
  name: modelmesh-runtime-adapter
  version: 0.12.0
  epoch: 0
  description: Unified runtime-adapter package of the sidecar containers which run in the modelmesh pods

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/kserve/modelmesh-runtime-adapter.git
      expected-commit: 5d0c9a008cce30b2b3839874c9f1f2ca8ddc38de
      tag: v${{package.version}}

subpackages:
  - name: "model-mesh-mlserver-adapter"
    description: "Adapter which implements the internal model-mesh model management API for MLServer Inference Server."
    pipeline:
      - uses: go/build
        with:
          output: mlserver-adapter
          packages: ./model-mesh-mlserver-adapter
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            model-mesh-mlserver-adapter | grep "MLServer runtime adapter started"

  - name: "model-mesh-ovms-adapter"
    description: "Adapter which implements the internal model-mesh model management API for OpenVINO Model Server."
    pipeline:
      - uses: go/build
        with:
          output: ovms-adapter
          packages: ./model-mesh-ovms-adapter
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            model-mesh-ovms-adapter | grep "OVMS Runtime started"

  - name: "model-mesh-torchserve-adapter"
    description: "Adapter which implements the internal model-mesh model management API for TorchServe."
    pipeline:
      - uses: go/build
        with:
          output: torchserve-adapter
          packages: ./model-mesh-torchserve-adapter
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            model-mesh-torchserve-adapter | grep "TorchServe runtime adapter started"

  - name: "model-mesh-triton"
    description: "Adapter which implements the internal model-mesh model management API for Triton Inference Server."
    pipeline:
      - uses: go/build
        with:
          output: triton-adapter
          packages: ./model-mesh-triton
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            model-mesh-triton | grep "Triton runtime adapter started"

  - name: "model-serving-puller"
    description: "A component of ModelMesh Serving which provides a common way to pull models from storage and hand them off to model runtime frameworks."
    pipeline:
      - uses: go/build
        with:
          output: puller
          packages: ./model-serving-puller
          ldflags: -s -w
      - uses: strip
    test:
      pipeline:
        - runs: |
            export CONTAINER_MEM_REQ_BYTES=1
            model-serving-puller | grep "starting clean up of cached clients"
