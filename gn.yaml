package:
  name: gn
  version: 0_git20230709
  epoch: 0
  description: "Meta-build system that generates build files for Ninja"
  copyright:
    - license: BSD-3-Clause
  dependencies:
    runtime:

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - clang-15
      - clang-15-default
      - git
      - patch
      - python-3.11
      - samurai

vars:
  COMMIT_HASH: "fae280eabe5d31accc53100137459ece19a7a295"

pipeline:
  - runs: |
      git clone https://gn.googlesource.com/gn --recursive --depth 9999
      cd gn
      git checkout -q ${{vars.COMMIT_HASH}}

  - runs: |
      cp -R *.patch gn/
      cd gn
      patch '-p1' < lfs64.patch

  - working-directory: gn
    runs: |
      python3 ./build/gen.py \
      --no-static-libstdc++ \
      --no-strip \
      --allow-warnings

      ninja -C out

  - working-directory: gn
    runs: |
      install -Dm755 out/gn "${{targets.destdir}}"/usr/bin/gn

  - uses: strip

update:
  enabled: false # no release or tag
