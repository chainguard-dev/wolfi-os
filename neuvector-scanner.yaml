package:
  name: neuvector-scanner
  version: 0_git20240408
  epoch: 0
  description: NeuVector vulnerability scanner for the SUSE NeuVector Container Security Platform
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - go
  environment:
    CGO_ENABLED: "1"

pipeline:
  - uses: fetch
    with:
      expected-sha256: 02c7ebc446e1aaf3b1eed2c9403516ee79af84982b6c0f19082b84ed9c70fce2
      uri: https://github.com/neuvector/scanner/archive/4ae32294c563020a13ff9c6fb90007fab66dab99.tar.gz

  - uses: go/bump
    with:
      deps: github.com/containerd/containerd@v1.6.26 github.com/docker/docker@v26.0.0 github.com/opencontainers/image-spec@v1.1.0 github.com/opencontainers/runc@v1.1.12 golang.org/x/net@v0.17.0 google.golang.org/grpc@v1.56.3 google.golang.org/protobuf@v1.33.0 github.com/docker/distribution@v2.8.2-beta.1+incompatible

  - uses: go/build
    with:
      modroot: .
      packages: .
      output: ${{package.name}}
      vendor: true
      ldflags: "-s -w"

  - uses: strip

data:
  - name: binaries
    items:
      task: NeuVector Scanner Task
      monitor: NeuVector Scanner Monitor

subpackages:
  - range: binaries
    name: ${{package.name}}-${{range.key}}
    description: "${{range.value}}"
    pipeline:
      - uses: go/build
        with:
          modroot: .
          packages: .
          output: ${{package.name}}-${{range.key}}
          ldflags: "-s -w"
          subpackage: "true"
          vendor: true

update:
  enabled: false # No releases or tags
