package:
  name: neuvector-scanner
  version: 0_git20240329
  epoch: 5
  description: NeuVector vulnerability scanner for the SUSE NeuVector Container Security Platform
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - go
  environment:
    CGO_ENABLED: "1"

pipeline:
  - uses: fetch
    with:
      expected-sha256: 3ce6e64f44e7d30e26f2b33ab5e6e7a4601b0eec5900ae76554edad5e4e3d9c0
      uri: https://github.com/neuvector/scanner/archive/c0e54f45a5060ac2840afbd493f5e1e0a287f167.tar.gz

  - uses: go/bump
    with:
      deps: google.golang.org/grpc@v1.56.3 github.com/containerd/containerd@v1.6.26 github.com/docker/docker@v26.0.0 github.com/opencontainers/image-spec@v1.1.0 github.com/opencontainers/runc@v1.1.12 golang.org/x/net@v0.17.0 google.golang.org/grpc@v1.56.3

  - uses: go/build
    with:
      modroot: .
      packages: .
      output: ${{package.name}}
      vendor: true
      ldflags: "-s -w"

  - uses: strip

data:
  - name: binaries
    items:
      task: NeuVector Scanner Task
      monitor: NeuVector Scanner Monitor

subpackages:
  - range: binaries
    name: ${{package.name}}-${{range.key}}
    description: "${{range.value}}"
    pipeline:
      - uses: go/build
        with:
          modroot: .
          packages: .
          output: ${{package.name}}-${{range.key}}
          ldflags: "-s -w"
          subpackage: "true"
          vendor: true

update:
  enabled: false # No releases or tags
