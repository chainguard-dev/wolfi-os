package:
  name: py3-mysqlclient
  version: 2.2.4
  epoch: 1
  description: MySQL database connector for Python
  copyright:
    - license: GPL-2.0
  dependencies:
    runtime:
      # - to be added::: runtime:: runtime

environment:
  environment:
    HOME: /home/build
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - mariadb-connector-c-dev
      - mariadb-dev
      - py3.11-pip
      - python-3.11-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/PyMySQL/mysqlclient
      tag: v${{package.version}}
      expected-commit: 9fd238b9e3105dcbed2b009a916828a38d1f0904

  - runs: |
      pip install -r requirements.txt
      pip install build
      export MYSQLCLIENT_CFLAGS=`mysql_config --cflags`
      export MYSQLCLIENT_LDFLAGS=`mysql_config --libs`
      python -m build --wheel

  - runs: |
      pip install dist/*.whl

  - runs: |
      mkdir -p ${{targets.destdir}}/usr/lib/python3.11/site-packages
      mv /usr/lib/python3.11/site-packages/MySQLdb ${{targets.destdir}}/usr/lib/python3.11/site-packages
      mv /usr/lib/python3.11/site-packages/mysqlclient-${{package.version}}.dist-info ${{targets.destdir}}/usr/lib/python3.11/site-packages

subpackages:
  - name: ${{package.name}}-wheel
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share
          cp -R dist/* ${{targets.subpkgdir}}/usr/share/

update:
  enabled: true
  github:
    identifier: PyMySQL/mysqlclient
    use-tag: true
