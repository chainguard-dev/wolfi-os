package:
  name: cifs-utils
  version: 7.0
  epoch: 0
  description: "CIFS filesystem user-space tools"
  copyright:
    - license: GPL-3.0-or-later

environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - libcap-dev
      - keyutils-dev
      - krb5-dev
      - autoconf
      - automake
      # - samba-dev
      - talloc-dev
      - py3-docutils
      - pkgconf-dev
      - libtool
      - libcap-ng
      - linux-pam-dev

pipeline:
  - uses: fetch
    with:
      uri: https://ftp.samba.org/pub/linux-cifs/cifs-utils/cifs-utils-${{package.version}}.tar.bz2
      expected-sha256: 0defaab85bd3ea46ffc45ab41fb0d0ad54d05ae2cfaa7e503de86d4f12bc8161

  - runs: |
      autoreconf -i

  - runs: |
      ./configure \
      --build=$CBUILD \
      --host=$CHOST \
      --prefix=/usr \
      --disable-systemd \
      --sbindir=/usr/bin
      make

  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/bin
      make DESTDIR="${{targets.destdir}}" ROOTSBINDIR=/usr/bin install
      # set mount.cifs uid, to enable none root mounting form fstab
      chmod +s "${{targets.destdir}}"/usr/bin/mount.cifs

  - uses: strip

update:
  enabled: true
  release-monitor:
    identifier: 287
