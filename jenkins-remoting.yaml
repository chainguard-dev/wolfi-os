package:
  name: jenkins-remoting
  version: 3077.vd69cf116da_6f
  epoch: 0
  description: Jenkins remoting
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation:
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - openjdk-17
      - maven

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/jenkinsci/remoting/archive/refs/tags/${{package.version}}.tar.gz
      expected-sha256: 6e8eac71fd11d50f3196b010f6d1ece6cff6c7d26dea28b2acb5f7828e628da2
  - runs: |
      export JAVA_HOME=/usr/lib/jvm/openjdk
      export LANG=en_US.UTF-8

      export MAVEN_OPTS="-DforkCount=2 -DskipTests=true"
      mvn install

      mkdir -p ${{targets.destdir}}/usr/share/jenkins
      mv target/remoting-999999-SNAPSHOT.jar ${{targets.destdir}}/usr/share/jenkins/agent.jar

      ln -sf ${{targets.destdir}}/usr/share/jenkins/agent.jar ${{targets.destdir}}/usr/share/jenkins/slave.jar
