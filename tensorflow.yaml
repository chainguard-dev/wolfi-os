package:
  name: tensorflow
  version: 2.13.0
  epoch: 0
  description: An Open Source Machine Learning Framework for Everyone
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - ca-certificates-bundle
      - wolfi-base
      - busybox
      - bazel-6
      - python3-dev
      - build-base
      - libLLVM-16
      - clang-16
      - py3-pip
      - bash
      - openjdk-11
      - py3-numpy

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/tensorflow/tensorflow.git
      tag: v${{package.version}}
      expected-commit: 1cb1a030a62b169d90d34c747ab9b09f332bf905

  - runs: |
      export JAVA_HOME=/usr/lib/jvm/java-11-openjdk

      ./configure

      # Build the pip package
      bazel build //tensorflow/tools/pip_package:build_pip_package
      ./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg
      pip install /tmp/tensorflow_pkg/tensorflow-version-tags.whl --prefix=/usr --root=${{targets.destdir}}

  - uses: strip

# TODO: update
