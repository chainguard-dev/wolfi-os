package:
  name: jupyterlab-docker-stacks
  version: 4.26.0.20241101
  epoch: 0
  description: Ready-to-run images containing Jupyter applications
  copyright:
    - license: BSD-3-Clause
  dependencies:
    runtime:
    #TODO for testing
      - python3

environment:
  contents:
    packages:
      - busybox
      - python3
      - py3-jupyter-core

pipeline:
  - uses: fetch
    with:
      expected-sha256: d8a57048e535547b39a0fe5968c2086dc1ca4ff20107bba817ab9de80e0970f6
      uri: https://github.com/jupyter/docker-stacks/archive/ac8453913cafb6e4f23b9f2288c484620f97e999.tar.gz

subpackages:
  - name: ${{package.name}}-base-notebook
    dependencies:
      runtime:
        - font-liberation
        # - jupyterhub-singleuser 
        # - jupyterlab
        - nbclassic
        # - pandoc TODO MAKE PACKAGE
        - run-one
    pipeline:
      - working-directory: images/base-notebook
        pipeline:
          - runs: |
              echo TODO

  - name: ${{package.name}}-minimal-notebook
    dependencies:
      runtime:
        # - bzip2
        # - ca-certificates-bundle
        # - glibc-locales
        # - tini
        # - wget
        # - glibc-locale-gen
    pipeline:
      - working-directory: images/minimal-notebook
        pipeline:
          - runs: |
              echo TODO
      
  - name: ${{package.name}}-docker-stacks-foundation
    dependencies:
      runtime:
        - bzip2
        - ca-certificates-bundle
        - glibc-locales
        - tini
        - wget
        - glibc-locale-gen
    pipeline:
      - working-directory: images/docker-stacks-foundation
        pipeline:
          - runs: |
              mkdir -p ${{targets.contextdir}}/usr/bin/fix/
              chmod a+rx fix-permissions
              cp fix-permissions ${{targets.contextdir}}/usr/bin/fix/

              # sed -i 's/^#force_color_prompt=yes/force_color_prompt=yes/' /etc/skel/.bashrc && \
              # echo 'eval "$(conda shell.bash hook)"' >> /etc/skel/.bashrc

              mkdir -p ${{targets.contextdir}}/usr/local/bin
              cp run-hooks.sh start.sh ${{targets.contextdir}}/usr/local/bin/

              mkdir ${{targets.contextdir}}/usr/local/bin/start-notebook.d && \
              mkdir ${{targets.contextdir}}/usr/local/bin/before-notebook.d
              cp 10activate-conda-env.sh ${{targets.contextdir}}/usr/local/bin/before-notebook.d/
