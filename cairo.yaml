package:
  name: cairo
  version: 1.18.0
  epoch: 0
  description: A vector graphics library
  copyright:
    - license: LGPL-2.0-or-later MPL-1.1

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - fontconfig-dev
      - freetype-dev
      - libxext-dev
      - libxrender-dev
      - pixman-dev
      - xcb-util
      - xcb-util-dev
      - expat-dev
      - glib-dev
      - libpng-dev
      - meson
      - zlib-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: abf8fba4d510086a492783c3e0828e90b32734738fd80906595617d229d02bab
      uri: https://gitlab.freedesktop.org/cairo/cairo/-/archive/${{package.version}}/cairo-${{package.version}}.tar.bz2

  - runs: |
      meson . output \
        -Db_lto=true \
        -Dgtk_doc=false \
        -Ddefault_library=both \
        -Dtests=disabled \
        --prefix=/usr

  - uses: meson/compile

  - uses: meson/install

  - uses: strip

subpackages:
  - name: cairo-static
    pipeline:
      - uses: split/static
    description: cairo static

  - name: cairo-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - cairo
        - cairo-tools
        - fontconfig-dev
        - freetype-dev
        - libxext-dev
        - libxrender-dev
        - pixman-dev
        - xcb-util-dev
    description: cairo dev

  - name: cairo-gobject
    # dependencies:
    #   provides:
    #     - cairo-gobject
    pipeline:
      - runs: |
          mkdir -p ${{targets.contextdir}}/usr/lib
          mv ${{targets.contextdir}}/usr/lib/libcairo-gobject.so.*  ${{targets.contextdir}}/usr/lib/
    description: cairo (gobject bindings)

  - name: cairo-tools
    pipeline:
      - runs: |
          mkdir -p ${{targets.contextdir}}/usr/bin
          mkdir -p ${{targets.contextdir}}/usr/lib/cairo

          mv ${{targets.contextdir}}/usr/bin/*  ${{targets.contextdir}}/usr/bin/
          mv ${{targets.contextdir}}/usr/lib/cairo/libcairo-trace.*  ${{targets.contextdir}}/usr/lib/cairo/
    description: cairo (development tools)

update:
  enabled: true
  release-monitor:
    identifier: 247
