package:
  name: usrmerge-baselayout
  version: 1.0
  epoch: 0

environment:
  contents:
    packages:
      - busybox

pipeline:
  - runs: |
      mkdir -p ${{targets.destdir}}/usr/bin
      ln -s usr/bin ${{targets.destdir}}/bin
      ln -s usr/bin ${{targets.destdir}}/sbin
      ln -s bin ${{targets.destdir}}/usr/sbin

      touch ${{targets.destdir}}/usr/bin/.placeholder

test:
  pipeline:
    - runs: |
        set +x
        fail() { echo "FATAL:" "$@" 1>&2; exit 1; }

        [ -d /usr/bin ] &&
          echo "PASS:" "/usr/bin is a dir" ||
          fail "/usr/bin doesn't exist or is not a dir. seriously."

        for p in /bin /sbin /usr/sbin; do
          [ -L "$p" ] &&
            echo "PASS: $p is a link" ||
              fail "$p is not a link"
          [ "$p" -ef /usr/bin ] &&
            echo "PASS: $p points to /usr/bin" ||
              fail "$p is not the same as /usr/bin"
        done

update:
  enabled: false
  exclude-reason: "this is the upstream"
