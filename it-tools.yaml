package:
  name: it-tools
  version: 2024.10.22
  epoch: 1
  description: Collection of handy online tools for developers, with great UX
  copyright:
    - license: GPL-3.0
  options:
    no-depends: true
  dependencies:
    runtime:
      - nginx

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - git
      - go
      - node-gyp
      - nodejs
      - npm
      - pnpm
  environment:
    NPM_CONFIG_LOGLEVEL: "warn"

pipeline:
  - runs: |
      git clone --depth=1 https://github.com/CorentinTh/it-tools.git
      cd it-tools
      # rmdir it-tools
      package_version="${{package.version}}"
      git fetch --tags
      latest_tag=$(git tag -l "v${package_version}-*" | sort -V | tail -n 1)

      git checkout ${latest_tag}

  - runs: |
      cd it-tools
      npm install -g pnpm
      pnpm i --frozen-lockfile
      pnpm build

  - runs: |
      mkdir -p ${{targets.contextdir}}/usr/share/nginx/html
      mv it-tools/dist/* ${{targets.contextdir}}/usr/share/nginx/html

  - uses: strip

update:
  enabled: true
  github:
    identifier: CorentinTh/it-tools
    strip-prefix: v
    use-tag: true
    strip-suffix: -.*
    tag-filter: v

test:
  pipeline:
    - name: Verify kargo version
      runs: ls
