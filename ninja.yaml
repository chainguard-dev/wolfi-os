package:
  name: ninja
  version: 1.11.1
  epoch: 0
  description: "a small build system with a focus on speed"
  target-architecture:
    - all
  copyright:
    - paths:
      - "*"
      attestation: TODO
      license: Apache-2.0
      
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - python3
      - build-base
      - cmake

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/ninja-build/ninja/archive/refs/tags/v${{package.version}}.tar.gz
      expected-sha256: 31747ae633213f1eda3842686f83c2aa1412e0f5691d1c14dbbcc67fe7400cea
  - runs: |
      ./configure.py --bootstrap
      cmake -DCMAKE_BUILD_TYPE=Release -B release-build
      cmake --build release-build --parallel --config Release
      ./release-build/ninja_test
  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/bin
      mv ./release-build/ninja "${{targets.destdir}}"/usr/bin

subpackages:
  - name: "ninja-doc"
    description: "ninja documentation"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share/doc/ninja"
          mv ./doc/manual.asciidoc "${{targets.subpkgdir}}/usr/share/doc/ninja"

          mkdir -p "${{targets.subpkgdir}}"/usr/share/bash-completion/completions/ninja
          mv ./misc/bash-completion "${{targets.subpkgdir}}"/usr/share/bash-completion/completions/ninja
