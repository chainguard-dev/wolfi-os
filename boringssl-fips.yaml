package:
  name: boringssl-fips
  version: 0.1
  epoch: 0
  description: The things I do for love
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - wolfi-baselayout
      - binutils
      - build-base
      - git
      - bazel-6
      - openjdk-11
      - bash
      - libtool
      - cmake
      - samurai
      - python3-dev
      - clang~15
      - llvm15
      - llvm15-dev
      - llvm-lld-15
      - llvm15-tools
      - llvm15-cmake-default
      - coreutils
      - patch
      - curl
      - ncurses~6.4_p20230722
      - perl
      # We need to stick to gcc 12 for now, envoy doesn't build with gcc >= 13
      - gcc-12-default

pipeline:

  - runs: |
      # This comes from https://github.com/envoyproxy/envoy/blob/main/bazel/external/boringssl_fips.genrule_cmd with a few mods to make old Clang works w/ newer cstdlib
      ./boringssl-fips.sh

      mkdir -p ${{targets.destdir}}/usr/lib
      find . -name libcrypto.a -exec cp {} ${{targets.destdir}}/usr/lib \;
      find . -name libssl.a -exec cp {} ${{targets.destdir}}/usr/lib \;
