package:
  name: tolua++
  version: 1.0.93
  epoch: 0
  description: a tool to integrate C/C++ code with Lua
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - lua5.4

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - lua5.4-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/LuaDist/toluapp.git
      tag: ${{package.version}}
      expected-commit: 9feb31ab8b97eda9561846508ee9e3a2caff8da7

  - uses: patch
    with:
      patches: version-change.patch

  - runs: |
      cd src

      gcc -fPIC -c lib/*.c  -I../include -I/usr/include/lua5.4
      ar rcsv libtolua++.a ./*.o

      gcc bin/tolua.c bin/toluabind.c -I../include -I/usr/include/lua5.4 -L. -L/usr/lib/lua5.4 -llua -ltolua++ -o tolua++

  - runs: |
      cd src
      install -d "${{targets.destdir}}"/usr/lib "${{targets.destdir}}"/usr/bin "${{targets.destdir}}"/usr/include/lua5.4
      install libtolua++.a "${{targets.destdir}}"/usr/lib/
      install tolua++ "${{targets.destdir}}"/usr/bin/
      install ../include/tolua++.h "${{targets.destdir}}"/usr/include/lua5.4/

update:
  enabled: true
  github:
    identifier: LuaDist/toluapp
    use-tag: true
