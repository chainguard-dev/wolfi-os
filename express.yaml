package:
  name: express
  version: 4.21.0
  epoch: 0
  description: "Fast, unopinionated, minimalist web framework for node."
  copyright:
    - license: MIT
  checks:
    disabled:
      - usrlocal
  dependencies:
    runtime:
      - nodejs

environment:
  contents:
    packages:
      - npm

pipeline:
  - uses: npm/install
    with:
      prefix: "${{targets.contextdir}}/usr/local/"
      package: ${{package.name}}
      version: ${{package.version}}

update:
  enabled: true
  github:
    identifier: expressjs/express

test:
  environment:
    contents:
      packages:
        - npm
  pipeline:
    - name: check express installed
      runs: |
        npm list -g | grep express
        npm list express -g | grep ${{package.version}}
    - name: hello world
      runs: |
        cat <<EOF > app.js
        const express = require('express');
        const app = express();
        const port = 3000;
        app.get('/', (req, res) => {
            res.send('Hello World!');
        });
        setTimeout(() => {
            console.log('Server will exit now.');
            process.exit(0); // Exit the application after 3 seconds
        }, 3000);
        app.listen(port, () => {
            console.log(`Server listening on port ${port}`);
        });
        EOF
        npm init -y
        npm install $(npm root -g)/express
        node app.js
