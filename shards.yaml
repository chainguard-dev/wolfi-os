package:
  name: shards
  version: 0.17.3
  epoch: 0
  description: "Dependency manager for the Crystal language"
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - crystal
      - gc-dev
      - yaml-dev
      - libevent-dev
      - pcre2-dev

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/crystal-lang/shards/archive/v${{package.version}}.tar.gz
      expected-sha256: 6512ff51bd69057f4da4783eb6b14c29d9a88b97d35985356d1dc644a08424c7
      extract: true

  - uses: fetch
    with:
      uri: https://github.com/crystal-lang/crystal-molinillo/archive/v0.2.0.tar.gz
      expected-sha256: e231cf2411a6a11a1538983c7fb52b19e650acc3338bd3cdf6fdb13d6463861a
      extract: false

  - runs: |
      mkdir -p lib/molinillo
      tar -xf v0.2.0.tar.gz --strip-components=1 -C lib/molinillo
      rm -f v0.2.0.tar.gz

      make release=1
      install -d -m 0755 "${{targets.destdir}}"/usr/bin
      install -m 0755 bin/shards  "${{targets.destdir}}"/usr/bin/shards

  - uses: strip

update:
  enabled: true
  github:
    identifier: crystal-lang/shards
    use-tag: true
