package:
  name: i2c-tools
  version: "4.4"
  epoch: 2
  description: Tools for monitoring I2C devices
  copyright:
    - license: GPL-2.0-or-later AND LGPL-2.1-or-later

vars:
  import: smbus
  py-version: 3.13

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - linux-headers
      - openssf-compiler-options
      - py${{vars.py-version}}-build-base-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: af01d0fbe78e109a2db7137c7e9bfda3f3fb236c3177744c0f2695d1056cde71
      uri: https://fossies.org/linux/misc/i2c-tools-${{package.version}}.tar.gz

  - runs: |
      make DESTDIR="${{targets.destdir}}"
      make DESTDIR="${{targets.destdir}}" install

  - uses: strip

subpackages:
  - name: i2c-tools-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - i2c-tools
    description: i2c-tools dev

  - name: i2c-tools-doc
    pipeline:
      - uses: split/manpages
    description: i2c-tools manpages

  - name: py${{vars.py-version}}-smbus
    description: i2c-tools python bindings
    dependencies:
      runtime:
        - i2c-tools
        - python-${{vars.py-version}}-base
    options:
      no-depends: true
    pipeline:
      - uses: py/pip-build-install
        with:
          python: python${{vars.py-version}}
        working-directory: py-smbus
    test:
      pipeline:
        - uses: python/import
          with:
            python: python${{vars.py-version}}
            import: ${{vars.import}}

update:
  enabled: true
  release-monitor:
    identifier: 9272

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        i2cdetect -V
        i2cdump -V
        i2cget -V
        i2cset -V
        i2ctransfer -V
