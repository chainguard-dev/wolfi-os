package:
  name: cgal
  version: "5.6.1"
  epoch: 0
  description: Efficient and reliable geometric algorithms as C++ library
  copyright:
    - license: GPL-3.0-or-later custom

environment:
  contents:
    packages:
      - autoconf
      - automake
      - boost-dev
      - build-base
      - busybox
      - bzip2-dev
      - ca-certificates-bundle
      - cmake
      - gcc-12
      - gcc-12-default
      - glu-dev
      - gmp-dev
      - icu-dev
      - libuv-dev
      - mesa-dev
      - mpfr-dev
      - ninja
      - xz-dev
      - zlib-dev
      - zstd-dev
  environment:
    CC: gcc
    CXX: g++

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/CGAL/cgal
      tag: v${{package.version}}
      expected-commit: 188e51bad36ffc30e49dbabda29620b71a84664c

  - runs: |
      cmake -B build -G Ninja \
        -DCMAKE_BUILD_TYPE=MinSizeRel \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_INSTALL_LIBDIR=/usr/lib
      cmake --build build

  - runs: |
      DESTDIR="${{targets.destdir}}" cmake --install build
      mkdir -p "${{targets.destdir}}"/usr/share/licenses/${{package.name}}
      install -t "${{targets.destdir}}"/usr/share/licenses/${{package.name}} -Dm644 LICENSE*

  - uses: strip

subpackages:
  - name: cgal-dev
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          cp ./MacOSX/scripts/cgal_make_macosx_app ${{targets.subpkgdir}}/usr/bin/cgal_make_macosx_app
          cp ./Scripts/scripts/cgal_create_cmake_script ${{targets.subpkgdir}}/usr/bin/cgal_create_cmake_script
          cp ./Scripts/scripts/cgal_create_CMakeLists ${{targets.subpkgdir}}/usr/bin/cgal_create_CMakeLists
    dependencies:
      runtime:
        - cgal
    description: cgal dev

  - name: cgal-doc
    pipeline:
      - uses: split/manpages
    description: cgal manpages

update:
  enabled: true
  github:
    identifier: CGAL/cgal
    strip-prefix: v
