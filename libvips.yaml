package:
  name: libvips
  version: 8.16.0
  epoch: 1
  description: "A fast image processing library with low memory needs"
  copyright:
    - license: LGPL-2.1-or-later

environment:
  contents:
    packages:
      - bubblewrap
      - build-base
      - busybox
      - cmake
      - expat-dev
      - fftw-dev
      - glib-dev
      - highway-dev
      - imagemagick-7-dev
      - lcms2-dev
      - libarchive-dev
      - libexif-dev
      - libimagequant-dev
      - libjpeg-turbo-dev
      - librsvg-dev
      - meson
      - openexr-dev
      - openssf-compiler-options
      - orc-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/libvips/libvips
      expected-commit: 8dd05105843830110cad2338e0af145a682d4708
      tag: v${{package.version}}

  - uses: meson/configure
    with:
      opts: |
        -Dauto_features=enabled \
        -Dcfitsio=disabled \
        -Dcgif=disabled \
        -Dspng=disabled \
        -Dopenslide=disabled \
        -Dmatio=disabled \
        -Dopenjpeg=disabled \
        -Dpdfium=disabled \
        -Dheif=disabled \
        -Djpeg-xl=disabled \
        -Dnifti=disabled \
        -Dpoppler=disabled \
        -Dintrospection=disabled

  - uses: meson/compile

  - uses: meson/install

  - uses: strip

subpackages:
  - name: libvips-dev
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf

  - name: libvips-doc
    pipeline:
      - uses: split/manpages

update:
  enabled: true
  ignore-regex-patterns:
    - ".*-beta"
    - ".*-rc\\d+$"
  github:
    identifier: libvips/libvips
    strip-prefix: v

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        vips --version
        vipsedit --help
        vipsheader --version
        vipsthumbnail --version
        vips --help
        vipsheader --help
        vipsthumbnail --help
        vips --vips-config | grep svg
        vips --vips-config | grep png
