package:
  name: hadoop-runner-3.4
  # this project does releases but docker related config lives on another branch.
  # version below is from commit 5bb6f450340fa3deb931571d08d42a3f358af8bf
  version: 0_git20240627
  epoch: 0
  description: required runtime environment for running hadoop
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - async-profiler
      - byteman
      - byteman-compat
      - coreutils
      - dumb-init
      - jq
      - krb5
      - netcat-openbsd
      - py3-pip
      - py3-robotframework
      - python3
      - sudo

environment:
  contents:
    packages:
      - busybox

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/apache/hadoop
      # this branch is where the hadoop-runner base image comes from.
      # for update please look into the PR that are updating the base image.
      # previous work: https://github.com/apache/hadoop/pull/6910
      branch: docker-hadoop-runner-jdk11-u2204
      expected-commit: 5bb6f450340fa3deb931571d08d42a3f358af8bf

  - runs: |
      mkdir -p ${{targets.contextdir}}/opt
      mkdir -p ${{targets.contextdir}}/opt/profiler/build
      cp scripts/starter.sh ${{targets.contextdir}}/opt/starter.sh
      cp scripts/envtoconf.py ${{targets.contextdir}}/opt/envtoconf.py
      cp scripts/transformation.py ${{targets.contextdir}}/opt/transformation.py
      cp krb5.conf ${{targets.contextdir}}/opt/krb5.conf
      ln -sf /usr/lib/async-profiler.jar ${{targets.contextdir}}/opt/profiler/build/async-profiler.jar
      ln -sf /usr/lib/libasyncProfiler.so ${{targets.contextdir}}/opt/profiler/build/libasyncProfiler.so

update:
  enabled: true
  git: {}
  schedule:
    period: daily
    reason: Commit at head of branch is something we want to track.
