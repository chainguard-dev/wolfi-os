package:
  name: melange-helpers
  version: 0.0.1
  epoch: 0
  description: helpers for melange
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - build-base
      - busybox
      - go

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/smoser/melange-helpers.git
      tag: v${{package.version}}
      expected-commit: 6a82d8ea46473a12eeed120872dd0aebe934c80e

  - uses: strip

subpackages:
  - name: "ldd-check"
    description: ldd-check tool
    pipeline:
      - runs: |
          install -D -m0755 ldd-check/ldd-check ${{targets.contextdir}}/usr/bin/ldd-check
    dependencies:
      runtime:
        - apk-tools
        - busybox
        - posix-libc-utils
    test:
      pipeline:
        - runs: |
            [ -f /usr/bin/ldd-check ]
            [ -x /usr/bin/ldd-check ]

  - name: "usrmerge-tool"
    description: usrmerge tool
    pipeline:
      - runs: |
          ( cd usrmerge-tool && go build ./... )
          install -D -m0755 usrmerge-tool/usrmerge-tool ${{targets.contextdir}}/usr/bin/usrmerge-tool
    test:
      pipeline:
        - runs: |
            usrmerge-tool --help

update:
  enabled: true
  github:
    identifier: smoser/melange-helpers
    strip-prefix: v
    use-tag: true
