package:
  name: spdx-tools-java
  version: 1.1.8
  epoch: 0
  description: SPDX Command Line Tools using the Spdx-Java-Library
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - openjdk-22-jre

environment:
  contents:
    packages:
      - busybox
      - maven
      - openjdk-22
      - openjdk-22-default-jvm

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/spdx/tools-java.git
      tag: v${{package.version}}
      expected-commit: 0954dc8847bf9183138fb142fb92b6bd0be076b2

  - environment:
      TOOLS_JAVA_VERSION: ${{package.version}}
    runs: |
      mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install \
        && mkdir -p /usr/lib/java/spdx \
        && cp target/tools-java-$TOOLS_JAVA_VERSION-jar-with-dependencies.jar ${{targets.destdir}}/usr/lib/java/spdx/

      # Configure the wrapper script
      cp ./scripts/tools-java-wrapper.sh ${{targets.destdir}}/usr/bin/tools-java

      # Make the bwrapper match tools version
      sed -i "s/@@VERSION@@/$TOOLS_JAVA_VERSION/g" ${{targets.destdir}}/usr/bin/tools-java \
        && chmod +x ${{targets.destdir}}/usr/bin/tools-java


update:
  enabled: true
  github:
    identifier: spdx/tools-java
    use-tag: true

test:
  pipeline:
    - runs: echo hello # TODO
