package:
  name: squashfs-tools
  version: 4.6.1
  epoch: 0
  description: "Tools for squashfs, a highly compressed read-only filesystem for Linux"
  copyright:
    - license: GPL-2.0-or-later

environment:
  contents:
    packages:
      - bash
      - busybox
      - lz4-dev
      - xz-dev
      - zstd-dev
      - zlib-dev
      - attr-dev
      - build-base
      - lzo-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/plougher/squashfs-tools
      tag: ${{package.version}}
      expected-commit: d8cb82d9840330f9344ec37b992595b5d7b44184

  - runs: |
      make -C squashfs-tools XZ_SUPPORT=1 LZO_SUPPORT=1 LZ4_SUPPORT=1 ZSTD_SUPPORT=1

      make -C squashfs-tools \
      		INSTALL_MANPAGES_DIR="${{targets.destdir}}/usr/share/man/man1" \
      		INSTALL_PREFIX="${{targets.destdir}}/usr" \
      		USE_PREBUILT_MANPAGES=y \
      		install

  - uses: strip

subpackages:
  - name: "squashfs-tools-doc"
    description: "squashfs-tools documentation"
    pipeline:
      - uses: split/manpages

update:
  enabled: true
  github:
    identifier: plougher/squashfs-tools
# test:
#   pipeline:
#     - runs: |
#         apptainer version
#         apptainer help
#     # test adding remote. can't do build just yet because we dont have squashfs-tools pkg
#     - runs: |
#         apptainer remote add --no-login docker docker://docker.io
