package:
  name: ruby3.4-mini_portile2
  version: 2.8.8
  epoch: 0
  description: Simple autoconf and cmake builder for developers
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - ruby-${{vars.rubyMM}}

environment:
  contents:
    packages:
      - ruby-${{vars.rubyMM}}
      - ruby-${{vars.rubyMM}}-dev

vars:
  gem: mini_portile2

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/flavorjones/mini_portile
      tag: v${{package.version}}
      expected-commit: 17cd199e99daf84f80b2d144eff5bc699aa21a9c

  - uses: ruby/build
    with:
      gem: ${{vars.gem}}

  - uses: ruby/install
    with:
      gem: ${{vars.gem}}
      version: ${{package.version}}

  - uses: ruby/clean

test:
  environment:
    contents:
      packages:
        - autoconf
        - automake
        - build-base
        - busybox
        - cmake
        - gcc
        - libtool
        - make
  pipeline:
    - name: Validate import
      runs: ruby -e "require 'mini_portile2'"
    - name: Test example recipe in docs
      runs: |
        cat > test.rb <<EOT
        require "mini_portile2"

        recipe = MiniPortile.new("libiconv", "1.13.1")
        recipe.files = ["http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.13.1.tar.gz"]
        recipe.cook
        recipe.activate
        EOT

        ruby test.rb

update:
  enabled: true
  github:
    identifier: flavorjones/mini_portile
    strip-prefix: v
    tag-filter: v

var-transforms:
  - from: ${{package.name}}
    match: ^ruby(\d\.\d+)-.*
    replace: $1
    to: rubyMM
