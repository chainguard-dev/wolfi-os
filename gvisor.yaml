package:
  name: gvisor
  version: 20240617.0
  epoch: 0
  description: Application Kernel for Containers
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - bash
      - bazel-6
      - build-base
      - busybox
      - go
      - openjdk-11
  environment:
    JAVA_HOME: /usr/lib/jvm/java-11-openjdk

pipeline:
  - uses: git-checkout
    with:
      expected-commit: a1352e9079e50901d393d4bc4466ea42a3ff1d65
      repository: https://github.com/google/gvisor
      tag: release-${{package.version}}

  # The build expects to find gcc at /usr/bin/${arch}-linux-gnu-gcc so symlink ours there.
  - runs: ln -s /usr/bin/gcc /usr/bin/${{build.arch}}-linux-gnu-gcc

  - runs: bazel build //runsc:runsc --config=${{build.arch}}

  - uses: strip

update:
  enabled: true
  github:
    identifier: google/gvisor
    strip-prefix: release-
