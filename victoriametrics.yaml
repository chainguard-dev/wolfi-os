package:
  name: victoriametrics
  version: 1.102.1
  epoch: 0
  description: VictoriaMetrics is a fast, cost-effective, and scalable monitoring solution and time series database designed for high performance and reliability. It supports both single-server and clustered installations, providing flexibility for various deployment needs, and integrates well with tools like Grafana for data visualization.
  copyright:
    - license: Apache-2.0

data:
  - name: victoria-packages
    items:
      victoria-metrics:
      vmagent:
      vmalert:

pipeline:
  - uses: git-checkout
    with:
      expected-commit: 996b623585d1945a298d95d9e2ea4f055e2dcd2a
      repository: https://github.com/VictoriaMetrics/VictoriaMetrics
      tag: v${{package.version}}

subpackages:
  - range: victoria-packages
    name: "${{package.name}}-${{range.key}}"
    description: >
      ${{range.key}} is a tool for VictoriaMetrics.

    pipeline:
      - uses: go/build
        with:
          tags: nethttpomithttp2
          packages: ./app/${{range.key}}
          output: ${{range.key}}
          ldflags: -X github.com/VictoriaMetrics/VictoriaMetrics/lib/buildinfo.Version=${{range.key}}-$(date -u -d "@${SOURCE_DATE_EPOCH:-$(date +%s)}" "+%Y-%m-%dT%H:%M:%SZ")-$(git rev-parse HEAD)
    test:
      pipeline:
        - name: Test the ${{range.key}} binary
          runs: |
            ${{range.key}} -version

  - range: victoria-packages
    name: "${{package.name}}-${{range.key}}-compat"
    description: Compatibility package to place binaries in the location expected by upstream Dockerfile
    pipeline:
      - runs: |
          mkdir -p ${{targets.contextdir}}/
          ln -sf /usr/bin/${{range.key}} ${{targets.contextdir}}/${{range.key}}

update:
  enabled: true
  github:
    identifier: VictoriaMetrics/VictoriaMetrics
    strip-prefix: v
