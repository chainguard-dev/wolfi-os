package:
  name: kserve
  version: 0.13.1
  epoch: 1
  description: "Standardized Serverless ML Inference Platform on Kubernetes"
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - go

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/kserve/kserve
      tag: v${{package.version}}
      expected-commit: e7d9ac8c48900bfd6db4821305b762bc51d8a67b

subpackages:
  - name: kserve-agent
    pipeline:
      - uses: go/build
        with:
          modroot: .
          packages: ./cmd/agent
          output: agent

  - name: kserve-agent-compat
    dependencies:
      runtime:
        - kserve-agent
    pipeline:
      - runs: |
          mkdir -p "${{targets.contextdir}}/ko-app"
          ln -s ../usr/bin/agent "${{targets.contextdir}}/ko-app/agent"
    test:
      environment:
        contents:
          packages:
            - busybox
      pipeline:
        - name: "check paths"
          runs: |
            [ -x /ko-app/agent -a -f /ko-app/agent ]

  - name: kserve-router
    pipeline:
      - uses: go/build
        with:
          modroot: .
          packages: ./cmd/router
          output: router

  - name: kserve-router-compat
    dependencies:
      runtime:
        - kserve-router
    pipeline:
      - runs: |
          mkdir -p "${{targets.contextdir}}/ko-app"
          ln -s ../usr/bin/router "${{targets.contextdir}}/ko-app/router"
    test:
      environment:
        contents:
          packages:
            - busybox
      pipeline:
        - name: "check paths"
          runs: |
            [ -x /ko-app/router -a -f /ko-app/router ]

update:
  enabled: true
  github:
    identifier: kserve/kserve
    strip-prefix: v
