package:
  name: heimdal
  version: 7.8.0
  epoch: 1
  description: "Implementation of Kerberos 5"
  target-architecture:
    - all
  copyright:
    - paths:
      - "*"
      attestation: TODO
      license: BSD-3-Clause

environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - gawk
      - libtool
      - system-python
      - readline-dev
      - sqlite-dev
      - texinfo
      # - perl-json
      - gdbm-dev
      - ncurses-dev
      - perl

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/heimdal/heimdal/releases/download/heimdal-${{package.version}}/heimdal-${{package.version}}.tar.gz
      expected-sha512: 0167345aca77d65b7a1113874eee5b65ec6e1fec1f196d57e571265409fa35ef95a673a4fd4aafbb0ab5fb5b246b97412353a68d6613a8aff6393a9f1e72999e
  - runs: |
      ./configure \
        --build=$CBUILD \
        --host=$CHOST \
        --prefix=/usr \
        --enable-shared=yes \
        --without-x \
        --without-berkeley-db \
        --with-readline-lib=/usr/lib \
        --with-readline-include=/usr/include/readline \
        --with-sqlite3=/usr \
        --without-openssl \
        --with-db-type-preference=
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip

subpackages:
  - name: "heimdal-dev"
    description: "headers for heimdal"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - heimdal

  - name: "heimdal-doc"
    description: "heimdal manpages"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
