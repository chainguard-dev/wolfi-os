package:
  name: systemtap
  version: 5.1
  description: system-wide probe/trace tool
  copyright:
    - license: GPL-2.0-only
  dependencies:
    runtime:
      - build-base
      - busybox
      - glibc

environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - build-base
      - busybox
      - clang-16
      - elfutils-dev
      - gcc
      - glibc-dev
      - python-3.12-dev
      - py3.12-setuptools
      - py3-jupyter-core

pipeline:
  - uses: git-checkout
    with:
      repository: https://sourceware.org/git/systemtap.git
      branch: release-${{package.version}}
      depth: 1
  - uses: patch
    with:
      patches: remove-interactive-notebooks.patch
  - uses: autoconf/configure
  - name: Make
    runs: |
      set -x
      make all
  - name: Install
    runs: |
      set -x
      make install DESTDIR="${{targets.destdir}}"

update:
  enabled: true
  release-monitor:
    identifier: 4934
