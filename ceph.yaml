package:
  name: ceph
  version: 17.2.8
  description: Distributed object, block, and file storage
  copyright:
    - license: LGPL-2.1
  dependencies:
    runtime:
      - curl
      - libaio
      - libedit
      - libgcc
      - libstdc++
      - libudev
      - openssl
      - python-3.13
      - zlib

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bison
      - bash
      - build-base
      - busybox
      - cmake
      - cryptsetup-dev
      - curl-dev
      - eudev
      - expat-dev
      - flex
      - gcc
      - gettext
      - gperf
      - graphviz
      - jaeger
      - keyutils-dev
      - krb5-dev
      - libaio-dev
      - libedit-dev
      - libtirpc-dev
      - libtool
      - lttng-ust-dev
      - lttng-ust-tools
      - lz4-dev
      - make
      - ninja
      - oath-toolkit-dev
      - openldap-dev
      - openssl-dev
      - pkgconf
      - py3.13-setuptools
      - py3.13-sphinx
      - snappy-dev
      - systemd-dev
      - util-linux-dev
      - zlib-dev
      - babeltrace-2
      - lua5.3-dev
      - nasm
      - xfsprogs
      - py3.13-cython
      - python-3.13-dev
      - libnl3-dev
      - libcap-ng-dev
      - yaml-cpp-dev
      - glib-dev
      - py3.13-pyyaml
      - posix-libc-utils
      - nodejs
      - npm
      - boost-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/ceph/ceph.git
      tag: v${{package.version}}
      expected-commit: f817ceb7f187defb1d021d6328fa833eb8e943b3
      recurse-submodules: true

  - uses: cmake/configure
    with:
      opts: |
        -DWITH_RADOSGW=OFF \
        -DWITH_FUSE=OFF \
        -DWITH_MANPAGE=OFF \
        -DWITH_RDMA=OFF \
        -DWITH_BABELTRACE=OFF \
        -DLUA_LIBRARIES=/usr/lib/lua5.3 \
        -DCYTHON_VERSION=3.0.11 \
        -DWITH_SYSTEM_BOOST=ON \
        -DWITH_SYSTEM_NPM=ON
  - uses: cmake/build
  - uses: cmake/install
  - uses: strip
