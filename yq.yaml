package:
  name: yq
  version: 4.41.1
  epoch: 0
  description: "yq is a portable command-line YAML, JSON, XML, CSV and properties processor"
  copyright:
    - license: Apache-2.0

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/mikefarah/yq
      tag: v${{package.version}}
      expected-commit: 047694546cad8f9eaac1627bbc8bcc502fdd88bf

  - uses: go/build
    with:
      packages: .
      output: yq

  - runs: |
      ${{targets.destdir}}/usr/bin/yq --version | grep "version v${{package.version}}"

  - uses: strip

update:
  enabled: true
  github:
    identifier: mikefarah/yq
    strip-prefix: v

test:
  environment:
    contents:
      packages:
        - busybox
  pipeline:
    - name: "Verify yq installation and version"
      runs: |
        yq --version
    - name: "Test basic YAML processing"
      runs: |
        echo 'name: John Doe' | yq eval '.name' - | grep -q "John Doe"
    - name: "Test JSON to YAML conversion"
      runs: |
        echo '{"name": "Jane Doe"}' | yq eval -P - | grep -q "name: Jane Doe"
    - name: "Test merging two YAML files"
      runs: |
        echo 'name: John Doe' > file1.yaml
        echo 'age: 30' > file2.yaml
        yq eval-all 'select(fileIndex == 0) * select(fileIndex == 1)' file1.yaml file2.yaml | grep -q "age: 30"
