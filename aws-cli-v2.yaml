package:
  name: aws-cli-v2
  version: 2.13.10
  epoch: 0
  description: "Universal Command Line Interface for Amazon Web Services"
  copyright:
    - license: Apache-2.0
  dependencies:
    provides:
      - aws-cli=2
    runtime:
      - python3
      - py3-awscrt
      - py3-certifi
      - py3-cryptography
      - py3-dateutil
      - py3-distro
      - py3-colorama
      - py3-docutils
      - py3-jmespath
      - py3-urllib3-1
      - py3-prompt-toolkit
      - aws-crt-cpp

environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base

      - python3-dev
      - py3-gpep517
      - py3-flit-core

      - apk-tools
      - aws-crt-cpp-dev

      - py3-awscrt
      - py3-distro
      - py3-botocore
      - py3-docutils
      - py3-jmespath
      - py3-rsa
      - py3-s3transfer
      - py3-colorama
      - py3-cryptography
      - py3-certifi
      - py3-dateutil
      - py3-colorama
      - py3-urllib3-1
      - py3-prompt-toolkit
      - py3-ruamel-yaml

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/aws/aws-cli
      tag: ${{package.version}}
      expected-commit: 220a5dfbf7e67fb891c2ba6b1d9e532457d1a601

  - runs: |
      python3 -m gpep517 build-wheel \
        --wheel-dir dist \
        --output-fd 3 3>&1 >&2

  - runs: |
      python3 -m installer -d "${{targets.destdir}}" dist/*.whl

      rm "${{targets.destdir}}"/usr/bin/aws.cmd

  - uses: strip

update:
  enabled: true
  github:
    identifier: aws/aws-cli
    use-tag: true
    tag-filter: "2"
