package:
  name: setuptools
  version: 69.2.0
  epoch: 1
  description: Easily download, build, install, upgrade, and uninstall Python packages
  copyright:
    - license: "MIT"
  dependencies:
    provides:
      - whl:setuptools=${{package.version}}

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - cmd:pip
      - cmd:wheel
      - python-3.10-base
      - python-3.11-base
      - python-3.12-base
      - wolfi-base

data:
  - name: py-versions
    items:
      3.12: 312
      3.11: 311
      3.10: 310

pipeline:
  - uses: fetch
    with:
      expected-sha256: 0ff4183f8f42cd8fa3acea16c45205521a4ef28f73c6391d8a25e92893134f2e
      uri: https://files.pythonhosted.org/packages/source/s/setuptools/setuptools-${{package.version}}.tar.gz

  - name: Build Python Wheels
    runs: |
      pip wheel --no-deps .
      mkdir -p ${{targets.destdir}}/usr/share/python-wheel/
      mv *.whl ${{targets.destdir}}/usr/share/python-wheel/

subpackages:
  - range: py-versions
    name: "py${{range.key}}-${{package.name}}"
    pipeline:
      - runs: |
          pip --python /usr/bin/python${{range.key}} install --no-compile --no-deps --root="${{targets.contextdir}}" --prefix=/usr ${{targets.destdir}}/usr/share/python-wheel/*.whl
          python${{range.key}} -m compileall --invalidation-mode=unchecked-hash -r100 ${{targets.contextdir}}/usr/lib/
    dependencies:
      #provider-priority: $${range.value}}
      provides:
        - py3-setuptools=${{package.version}}.${{range.key}}

update:
  enabled: true
  shared: true
  release-monitor:
    identifier: 4021
