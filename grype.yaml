package:
  name: grype
  version: 0.74.0
  epoch: 2
  description: Vulnerability scanner for container images, filesystems, and SBOMs
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - go
  environment:
    CGO_ENABLED: "0"

pipeline:
  - uses: fetch
    with:
      expected-sha512: b90270cf6cbefefeccd89e3a12633d2db6fb920e14f19bc994208393e31bf8b88d45d2ce6add20589e97ed4f0ad8ca6dd6f84b624083935def366fd191478788
      uri: https://github.com/anchore/grype/archive/v${{package.version}}/grype-${{package.version}}.tar.gz

  - uses: go/bump
    with:
      deps: github.com/cloudflare/circl@v1.3.7
      go-version: "1.21.0"

  - runs: |
      CGO_ENABLED=0 go build \
        -ldflags "-w -X github.com/anchore/grype/internal/version.version=${{package.version}}" \
        -o "${{targets.destdir}}/usr/bin/grype" ./cmd/grype

  - uses: strip

update:
  enabled: true
  github:
    identifier: anchore/grype
    strip-prefix: v

test:
  environment:
    contents:
      packages:
        - wolfi-base
  pipeline:
    - runs: |
        grype --version
