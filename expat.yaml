package:
  name: expat
  version: 2.6.2
  epoch: 2
  description: "XML SAX Parser library written in C"
  copyright:
    - license: MIT

var-transforms:
  - from: ${{package.version}}
    match: \.
    replace: _
    to: mangled-package-version

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bash
      - build-base
      - busybox
      - ca-certificates-bundle
      - gettext-dev
      - intltool
      - libtool

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/libexpat/libexpat.git
      tag: R_${{vars.mangled-package-version}}
      expected-commit: fa75b96546c069d17b8f80d91e0f4ef0cde3790d

  - working-directory: expat
    runs: |
      ./buildconf.sh

  - name: Configure
    working-directory: expat
    runs: |
      ./configure \
         --host=${{host.triplet.gnu}} \
         --target=${{host.triplet.gnu}} \
         --prefix=/usr \
         --datadir=/usr/share

  - uses: autoconf/make
    with:
      dir: expat

  - uses: autoconf/make-install
    with:
      dir: expat

  - uses: strip

subpackages:
  - name: "expat-dev"
    description: "expat headers"
    pipeline:
      - uses: split/dev

  - name: "libexpat1"
    description: "libexpat shared library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr
          mv "${{targets.destdir}}"/usr/lib "${{targets.subpkgdir}}"/usr/

update:
  enabled: true
  version-transform:
    - match: "_"
      replace: "."
  github:
    identifier: libexpat/libexpat
    tag-filter-prefix: R_
    strip-prefix: R_
