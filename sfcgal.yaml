# source is gitlab so we can't use github updates to get expected commit
#nolint:git-checkout-must-use-github-updates
package:
  name: sfcgal
  version: 1.5.1
  epoch: 0
  description: Library for ISO 19107:2013 and OGC SFA 1.2 for 3D operations
  copyright:
    - license: LGPL-2.0-or-later

environment:
  contents:
    packages:
      - autoconf
      - automake
      - boost-dev
      - build-base
      - busybox
      - ca-certificates-bundle
      - cgal-dev
      - cmake
      - gmp-dev
      - mpfr-dev
      - samurai

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.com/sfcgal/SFCGAL
      tag: v${{package.version}}
      expected-commit: 61f3b08ade49493b56c6bafa98c7c1f84addbc10

  - runs: |
      mkdir -p build && cd build
      cmake -Wno-dev \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_LIBDIR=lib \
        -DSFCGAL_BUILD_EXAMPLES=1 \
        -DSFCGAL_BUILD_TESTS=0 \
        ..
      make

  - runs: |
      cd build
      make DESTDIR="${{targets.destdir}}" install
      # installs tests
      rm -rf "${{targets.destdir}}"/usr/bin/*test*
      # Remove conflict with cgal package
      rm -rf "${{targets.destdir}}"/usr/include/CGAL

  - uses: strip

subpackages:
  - name: sfcgal-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - sfcgal
    description: sfcgal dev

# failed to create a latestVersion from package sfcgal: list.  Error: Malformed version: list
# https://release-monitoring.org/project/236494/
update:
  enabled: false
