package:
  name: colm
  version: 0.14.7
  description: Colm is a programming language and compiler that generates efficient parsers in C, C++, Objective-C, D, Java or Ruby from context-free grammars, allowing developers to embed actions into the productions of the grammar.
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - build-base
      - busybox
      - glibc

environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - autoconf
      - automake
      - bash
      - build-base
      - busybox
      - clang-16
      - cmake
      - gcc
      - libtool
      - sed

pipeline:
  - uses: fetch
    with:
      uri: https://www.colm.net/files/colm/colm-${{package.version}}.tar.gz
      expected-sha512: a5702cb8202599c75f4f4c1975d02e398f1394826f01b86039bd53a34f3ca250a7250d043a430ce6a383e6ca854fe4c72305891ab98c5f3d0ce54192423b7627
  - name: Configure Colm
    uses: autoconf/configure
    with: 
      opts: |
        --prefix=/opt/colm/colm \
        --disable-manual \
        --libdir=/opt/colm/colm/lib
  - name: Build Colm
    uses: autoconf/make
  # Note: cannot use the autoconf/configure pre-canned pipeline because it deletes libtool archives.
  # Even though leaving libtool archives around may not be great, colm's main dependency, ragel depends upon them to compile
  - name: Install Colm
    runs: |
      make install DESTDIR="${{targets.contextdir}}" V=1

update:
  enabled: true
  release-monitor:
    identifier: 12622
